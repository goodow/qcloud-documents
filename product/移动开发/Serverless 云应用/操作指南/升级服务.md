本文为您介绍当 Serverless 云应用中的服务已经部署完成并已经有流量后，如何进行升级。

## 基本概念

升级服务需要创建一个新的版本并部署。Serverless 云应用目前支持两种升级方式：

- 全量升级：指升级完成后，流量全部流向唯一一个版本。
- 灰度升级：指升级完成后，只将部分流量引向新版本。同一时间有多个版本在运行并提供服务。



## 全量升级

### 操作步骤
1. 登录 [Serverless 云应用控制台](https://console.cloud.tencent.com/tcb/service)，再按需要切换到指定的环境。
![](https://main.qcloudimg.com/raw/7ccca44479b1c0cf092234a8e0f1ee5a.png)

> ?Serverless 云应用公测期间，需要先 [申请开通](https://cloud.tencent.com/apply/p/y5uji0g6a7p)，审核通过后，云开发控制台的左侧菜单才会出现 【Serverless 云应用】入口，否则入口将不可见。公测结束后，**Serverless 云应用**的入口将对所有云开发用户开放。

2. 进入需要升级的服务详情。
选择您需要升级的服务，单击服务名称进入服务详情页面。
![](https://main.qcloudimg.com/raw/0549eee11a609f62ef5a95f77e6d969b.png)
3. 单击新建版本。
您应当至少已有一个服务版本在运行中。
![](https://main.qcloudimg.com/raw/74b7c4c1c429fe3bdf22d91609d7cb46.png)
4. 单击配置版本。
填写升级所需的版本配置信息，并在“流量策略”中选择“部署完成后自动开启100%流量”。
![](https://main.qcloudimg.com/raw/7e39b6a407b4bcc6f6ae0fc5f0f6e6da.png)
5. 开始部署。
 - 在新建版本窗口中，填写完版本配置信息后，单击【开始部署】。
 - 版本初始为“创建中”。部署成功则状态变为“正常”，且流量变为100%。若有报错，会变为具体的错误状态。
 - 单击错误状态查看，可以获取错误详情和处理建议。
![](https://main.qcloudimg.com/raw/42a8b25f4a9cadf973286f93c6c60d30.png)
6. 访问服务。
 - 完成升级后，您可能希望能够快速访问自己的服务查看升级后的效果。
 - Serverless 云应用自动为您的服务分配了一个默认域名，您可以直接单击【访问服务】，通过这个默认域名访问您的服务页面。

## 灰度升级

### 操作步骤

1. 单击新建版本。
您应当至少已有一个服务版本在运行中。
![](https://main.qcloudimg.com/raw/74b7c4c1c429fe3bdf22d91609d7cb46.png)

2. 单击配置版本。
填写升级所需的版本配置信息，并在“流量策略”中选择“部署完成后保持流量为0，稍后手动配置流量”。
![](https://main.qcloudimg.com/raw/2cc55d5e3c892a8255ff1be5b729767a.png)
3. 开始部署。
 - 在新建版本窗口中，填写完版本配置信息后，单击【开始部署】。
 - 版本初始为“创建中”。部署成功则状态变为“正常”，且流量为0%。若有报错，会变为具体的错误状态。
 - 单击错误状态查看，可以获取错误详情和处理建议。
![](https://main.qcloudimg.com/raw/42a8b25f4a9cadf973286f93c6c60d30.png)
4. 配置流量。
 - 单击【流量配置】。选中刚部署完的最新版本和当前运行中的旧版本，并为每个版本指定流量百分比。所有百分比加起来需要等于100，否则无法完成。
 - 单击【完成】，系统立刻开始按百分比随机分配流量，将部分流量从旧版本引向新版本。
![](https://main.qcloudimg.com/raw/37e221fb2a70bc83a8747a806f487231.png)
成功后，可以看到对应版本的流量百分比已经变化。
![](https://main.qcloudimg.com/raw/5e4ece25ca29fa06229762d3f7a24c53.png)
5. 访问服务。
 - 完成升级后，您可能希望能够快速访问自己的服务查看升级后的效果。
 - Serverless 云应用自动为您的服务分配了一个默认域名，您可以直接单击【访问服务】，通过这个默认域名访问您的服务页面。
 - 因为您采用的是灰度升级，请求将按百分比随机分配到新旧版本。这可能影响您访问服务时看到的现象。
![](https://main.qcloudimg.com/raw/74b7c4c1c429fe3bdf22d91609d7cb46.png)

## 相关操作

- 部署服务
- 回滚服务



